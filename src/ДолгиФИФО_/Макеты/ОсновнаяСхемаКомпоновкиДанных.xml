<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema">
		<dataSource>
			<name>ИсточникДанных1</name>
			<dataSourceType>Local</dataSourceType>
		</dataSource>
		<dataSet xsi:type="DataSetQuery">
			<name>НаборДанных1</name>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДоговорКонтрагента</dataPath>
				<field>ДоговорКонтрагента</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Долг</dataPath>
				<field>Долг</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Долг</d5p1:content>
					</d5p1:item>
				</title>
				<appearance>
					<item xmlns="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="dcsset:SettingsParameterValue">
						<parameter>Формат</parameter>
						<value xsi:type="xs:string">ЧДЦ=2</value>
					</item>
				</appearance>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Контрагент</dataPath>
				<field>Контрагент</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Организация</dataPath>
				<field>Организация</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Период</dataPath>
				<field>Период</field>
				<role>
					<periodNumber xmlns="http://v8.1c.ru/8.1/data-composition-system/common">2</periodNumber>
					<periodType xmlns="http://v8.1c.ru/8.1/data-composition-system/common">Main</periodType>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Регистратор</dataPath>
				<field>Регистратор</field>
				<role>
					<periodNumber xmlns="http://v8.1c.ru/8.1/data-composition-system/common">1</periodNumber>
					<periodType xmlns="http://v8.1c.ru/8.1/data-composition-system/common">Main</periodType>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Долгота</dataPath>
				<field>Долгота</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Прошло дней</d5p1:content>
					</d5p1:item>
				</title>
				<role>
					<periodNumber xmlns="http://v8.1c.ru/8.1/data-composition-system/common">3</periodNumber>
					<periodType xmlns="http://v8.1c.ru/8.1/data-composition-system/common">Main</periodType>
				</role>
			</field>
			<dataSource>ИсточникДанных1</dataSource>
			<query>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Остатки.Организация,
	Остатки.Контрагент,
	Остатки.ДоговорКонтрагента,
	&amp;Дата КАК Край,
	Остатки.СуммаВзаиморасчетовОстаток КАК Долг,
	0 КАК ПолуСумма,
	0 КАК Сдвиг
ПОМЕСТИТЬ Шаг536870912
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки(ДОБАВИТЬКДАТЕ(&amp;Дата, СЕКУНДА, 1), ДоговорКонтрагента.ВидДоговора = ЗНАЧЕНИЕ(Перечисление.ВидыДоговоровКонтрагентов.СПокупателем)) КАК Остатки
ГДЕ
	Остатки.СуммаВзаиморасчетовОстаток &gt; 0
{ГДЕ
	Остатки.Организация.*,
	Остатки.Контрагент.*,
	Остатки.ДоговорКонтрагента.*}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Обороты.ДоговорКонтрагента,
	Обороты.Период КАК Период,
	СУММА(Обороты.СуммаВзаиморасчетовОборот) КАК СуммаВзаиморасчетовОборот
ПОМЕСТИТЬ Обороты
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
			,
			&amp;Дата,
			Регистратор,
			ДоговорКонтрагента В
				(ВЫБРАТЬ
					Шаг.ДоговорКонтрагента
				ИЗ
					Шаг536870912 КАК Шаг)) КАК Обороты
ГДЕ
	Обороты.СуммаВзаиморасчетовОборот &gt; 0

СГРУППИРОВАТЬ ПО
	Обороты.ДоговорКонтрагента,
	Обороты.Период

ИНДЕКСИРОВАТЬ ПО
	Обороты.ДоговорКонтрагента,
	Период
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Шаг.ДоговорКонтрагента,
	Шаг.Край,
	Шаг.Долг,
	ЕСТЬNULL(СУММА(Обороты.СуммаВзаиморасчетовОборот), 0) КАК ПолуСумма,
	ВЫБОР
		КОГДА Шаг.Долг &gt; ЕСТЬNULL(СУММА(Обороты.СуммаВзаиморасчетовОборот), 0)
			ТОГДА -1
		ИНАЧЕ 0
	КОНЕЦ КАК Сдвиг
ПОМЕСТИТЬ Шаг1
ИЗ
	(ВЫБРАТЬ
		Шаг.ДоговорКонтрагента КАК ДоговорКонтрагента,
		Шаг.Долг + Шаг.Сдвиг * Шаг.ПолуСумма КАК Долг,
		ДОБАВИТЬКДАТЕ(Шаг.Край, СЕКУНДА, 536870912 * (Шаг.Сдвиг - 0.5) + 1) КАК Центр,
		ДОБАВИТЬКДАТЕ(Шаг.Край, СЕКУНДА, 536870912 * Шаг.Сдвиг) КАК Край
	ИЗ
		Шаг536870912 КАК Шаг) КАК Шаг
		ЛЕВОЕ СОЕДИНЕНИЕ Обороты КАК Обороты
		ПО Шаг.ДоговорКонтрагента = Обороты.ДоговорКонтрагента
			И (Обороты.Период МЕЖДУ Шаг.Центр И Шаг.Край)

СГРУППИРОВАТЬ ПО
	Шаг.ДоговорКонтрагента,
	Шаг.Край,
	Шаг.Долг
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Шаг.ДоговорКонтрагента,
	Шаг.Край,
	Шаг.Долг,
	ЕСТЬNULL(СУММА(Обороты.СуммаВзаиморасчетовОборот), 0) КАК Сумма
ПОМЕСТИТЬ Шаг0
ИЗ
	(ВЫБРАТЬ
		Шаг.ДоговорКонтрагента КАК ДоговорКонтрагента,
		Шаг.Долг + Шаг.Сдвиг * Шаг.ПолуСумма КАК Долг,
		ДОБАВИТЬКДАТЕ(Шаг.Край, СЕКУНДА, Шаг.Сдвиг) КАК Край
	ИЗ
		Шаг1 КАК Шаг) КАК Шаг
		ЛЕВОЕ СОЕДИНЕНИЕ Обороты КАК Обороты
		ПО Шаг.ДоговорКонтрагента = Обороты.ДоговорКонтрагента
			И (Обороты.Период = Шаг.Край)

СГРУППИРОВАТЬ ПО
	Шаг.ДоговорКонтрагента,
	Шаг.Край,
	Шаг.Долг
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	Шаг.ДоговорКонтрагента.Организация КАК Организация,
	Шаг.ДоговорКонтрагента.Владелец КАК Контрагент,
	Шаг.ДоговорКонтрагента КАК ДоговорКонтрагента,
	Обороты.Период КАК Период,
	Обороты.Регистратор КАК Регистратор,
	ВЫБОР
		КОГДА Обороты.Период = Шаг.Край
			ТОГДА Шаг.Долг * Обороты.СуммаВзаиморасчетовОборот / Шаг.Сумма
		ИНАЧЕ Обороты.СуммаВзаиморасчетовОборот
	КОНЕЦ КАК Долг,
	РАЗНОСТЬДАТ(Обороты.Период, &amp;Дата, ДЕНЬ) КАК Долгота
{ВЫБРАТЬ
	Организация.*,
	Контрагент.*,
	ДоговорКонтрагента.*,
	Период,
	Регистратор.*,
	Долг,
	Долгота}
ИЗ
	Шаг0 КАК Шаг
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
				,
				&amp;Дата,
				Регистратор,
				ДоговорКонтрагента В
					(ВЫБРАТЬ
						Шаг.ДоговорКонтрагента
					ИЗ
						Шаг0 КАК Шаг)) КАК Обороты
		ПО Шаг.ДоговорКонтрагента = Обороты.ДоговорКонтрагента
			И Шаг.Край &lt;= Обороты.Период
ГДЕ
	Обороты.СуммаВзаиморасчетовОборот &gt; 0
{ГДЕ
	Обороты.Период,
	Обороты.Регистратор,
	(ВЫБОР
			КОГДА Обороты.Период = Шаг.Край
				ТОГДА Шаг.Долг * Обороты.СуммаВзаиморасчетовОборот / Шаг.Сумма
			ИНАЧЕ Обороты.СуммаВзаиморасчетовОборот
		КОНЕЦ) КАК Долг,
	(РАЗНОСТЬДАТ(Обороты.Период, &amp;Дата, ДЕНЬ)) КАК Долгота}</query>
			<autoFillFields>false</autoFillFields>
		</dataSet>
		<totalField>
			<dataPath>Долг</dataPath>
			<expression>Сумма(Долг)</expression>
		</totalField>
		<parameter>
			<name>Дата</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Дата</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<settingsVariant>
			<name xmlns="http://v8.1c.ru/8.1/data-composition-system/settings">Основной</name>
			<presentation xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="xs:string">Основной</presentation>
		</settingsVariant>
	</dataCompositionSchema>
</SchemaFile>﻿<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<selection>
		<item xsi:type="SelectedItemField">
			<field>Организация</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Контрагент</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>ДоговорКонтрагента</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Период</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Регистратор</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Долг</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Долгота</field>
		</item>
	</selection>
	<dataParameters>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:parameter>Дата</dcscor:parameter>
			<dcscor:value xsi:type="v8:StandardBeginningDate">
				<v8:variant xsi:type="v8:StandardBeginningDateVariant">BeginningOfNextDay</v8:variant>
			</dcscor:value>
		</dcscor:item>
	</dataParameters>
	<order>
		<item xsi:type="OrderItemField">
			<field>Период</field>
			<orderType>Asc</orderType>
		</item>
	</order>
	<outputParameters>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:use>false</dcscor:use>
			<dcscor:parameter>РасположениеГруппировки</dcscor:parameter>
			<dcscor:value xsi:type="DataCompositionGroupPlacement">None</dcscor:value>
		</dcscor:item>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:use>false</dcscor:use>
			<dcscor:parameter>ГоризонтальноеРасположениеОбщихИтогов</dcscor:parameter>
			<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
		</dcscor:item>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:use>false</dcscor:use>
			<dcscor:parameter>ВертикальноеРасположениеОбщихИтогов</dcscor:parameter>
			<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
		</dcscor:item>
	</outputParameters>
	<item xsi:type="StructureItemGroup">
		<groupItems>
			<item xsi:type="GroupItemField">
				<field>Организация</field>
				<groupType>Items</groupType>
				<periodAdditionType>None</periodAdditionType>
				<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
				<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
			</item>
		</groupItems>
		<order>
			<item xsi:type="OrderItemAuto"/>
		</order>
		<selection>
			<item xsi:type="SelectedItemAuto"/>
		</selection>
		<item xsi:type="StructureItemGroup">
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>Контрагент</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
			<item xsi:type="StructureItemGroup">
				<groupItems>
					<item xsi:type="GroupItemField">
						<field>ДоговорКонтрагента</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
				</groupItems>
				<order>
					<item xsi:type="OrderItemAuto"/>
				</order>
				<selection>
					<item xsi:type="SelectedItemAuto"/>
				</selection>
				<item xsi:type="StructureItemGroup">
					<order>
						<item xsi:type="OrderItemAuto"/>
					</order>
					<selection>
						<item xsi:type="SelectedItemAuto"/>
					</selection>
				</item>
			</item>
		</item>
	</item>
</Settings>﻿<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema"/>
</SchemaFile>